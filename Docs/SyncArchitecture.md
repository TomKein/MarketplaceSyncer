# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å Business.ru

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ **–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–π –º–æ–¥–µ–ª–∏** —Å —Ç—Ä–µ–º—è —É—Ä–æ–≤–Ω—è–º–∏:

| –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –ù–∞–∑–≤–∞–Ω–∏–µ | –ü–æ–≤–µ–¥–µ–Ω–∏–µ |
|-----------|----------|-----------|
| ‚ö° **FORCE** | Daily/Force Full Resync | **–í—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (Parallel State).** –ü–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –¥–µ–Ω—å –ø–æ—Å–ª–µ Initial state (–∏–º–µ–µ—Ç —Å–≤–æ–∏ –∫—É—Ä—Å–æ—Ä—ã). |
| üî¥ **HIGH** | Initial (First Run) | –ë–ª–æ–∫–∏—Ä—É—é—â–∏–π. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –µ—Å–ª–∏ `InitialComplete` = false. |
| üü° **MEDIUM** | Incremental | –ü–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –µ—Å–ª–∏ –Ω–µ—Ç FORCE/HIGH –∑–∞–¥–∞—á. |
| üü¢ **LOW** | Full Reload | –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 01:00 –ú–°–ö. |

> [!NOTE]
> **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è**: `Daily Sync` –∏–º–µ–µ—Ç —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä –∫—É—Ä—Å–æ—Ä–æ–≤ (`Daily_Groups_Complete`, `Daily_Goods_Page` –∏ —Ç.–¥.).
> –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –∑–∞–ø—É—Å–∫ **–ù–ï —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç** —Ñ–ª–∞–≥ `InitialComplete` –∏ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π —Ñ–∞–∫—Ç –ø–µ—Ä–≤–∏—á–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏.
> –ü—Ä–∏ –Ω–∞—á–∞–ª–µ –Ω–æ–≤–æ–≥–æ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞, —Å–æ—Å—Ç–æ—è–Ω–∏–µ `Daily_*` —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ –Ω–æ–ª—å, –∏ –ø—Ä–æ—Ü–µ—Å—Å –∏–¥–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ.

---

## –ú–æ–¥–µ–ª—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚ö° FORCE: Daily Full Resync (Parallel State)                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–ª—é—á–∏: Daily_Groups_Complete, Daily_Goods_Page...  ‚îÇ
‚îÇ ‚Ä¢ –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 01:00 –ú–°–ö (–ø—Ä–æ–≤–µ—Ä–∫–∞ DailyStartedAt) ‚îÇ
‚îÇ ‚Ä¢ –ï—Å–ª–∏ —Ü–∏–∫–ª –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω, –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Å –º–µ—Å—Ç–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏            ‚îÇ
‚îÇ ‚Ä¢ –ï—Å–ª–∏ –Ω–∞—Å—Ç—É–ø–∏–ª –Ω–æ–≤—ã–π –¥–µ–Ω—å - —Å–±—Ä–æ—Å–∏—Ç DailyState –∏ –Ω–∞—á–Ω–µ—Ç –∑–∞–Ω–æ–≤–æ ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üî¥ HIGH: Initial Sync (First Run)                               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–ª—é—á–∏: Initial_Groups_Complete, Initial_Goods_Page ‚îÇ
‚îÇ ‚Ä¢ –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑, –µ—Å–ª–∏ –±–∞–∑–∞ –ø—É—Å—Ç–∞—è (InitialComplete=false)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
                    Initial complete?
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üü° MEDIUM: Incremental Updates (–ø–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º)                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚Ä¢ –ó–∞–ø—Ä–æ—Å –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞                 ‚îÇ
‚îÇ ‚Ä¢ –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã: —Ç–æ–≤–∞—Ä—ã (1 –º–∏–Ω), —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ (1 –¥–µ–Ω—å)               ‚îÇ
‚îÇ ‚Ä¢ –í—Å–µ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ Full Reload                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
                    –ï—Å—Ç—å —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è?
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üü¢ LOW: Full Reload (—Ñ–æ–Ω–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚Ä¢ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –ø—Ä–æ–º–µ–∂—É—Ç–∫–∞—Ö, –µ—Å–ª–∏ –Ω–µ—Ç –¥—Ä—É–≥–∏—Ö –∑–∞–¥–∞—á              ‚îÇ
‚îÇ ‚Ä¢ –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏, –Ω–µ –±–ª–æ–∫–∏—Ä—É—è —Å–∏—Å—Ç–µ–º—É              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –ê–ª–≥–æ—Ä–∏—Ç–º –≥–ª–∞–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞

```csharp
while (!stopping)
{
    // üî¥ HIGH: –±–ª–æ–∫–∏—Ä—É—é—â–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    if (!await IsInitialSyncCompleteAsync())
    {
        await RunInitialSyncAsync();  // –ë–ª–æ–∫–∏—Ä—É–µ–º –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
        continue;
    }
    
    // üü° MEDIUM: –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ incremental –∑–∞–¥–∞—á–∏
    var pendingIncrementals = GetDueIncrementalTasks();
    if (pendingIncrementals.Any())
    {
        foreach (var task in pendingIncrementals)
            await task.ExecuteAsync();
        continue;  // –ü–æ—Å–ª–µ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–Ω–æ–≤–∞
    }
    
    // üü¢ LOW: –µ—Å–ª–∏ –≤—Å—ë –≤—ã–ø–æ–ª–Ω–µ–Ω–æ ‚Äî —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ full reload
    if (HasPendingFullReloadWork())
    {
        await RunFullReloadChunkAsync();  // N —Å—Ç—Ä–∞–Ω–∏—Ü
        // –ù–µ –∂–¥—ë–º, —Å—Ä–∞–∑—É –ø—Ä–æ–≤–µ—Ä—è–µ–º MEDIUM —Å–Ω–æ–≤–∞
        continue;
    }
    
    // –ù–µ—Ç —Ä–∞–±–æ—Ç—ã ‚Äî –∂–¥—ë–º –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å—Ä–æ–∫–∞ MEDIUM
    await WaitUntilNextIncrementalDueAsync();
}
```

---

## Incremental –∑–∞–¥–∞—á–∏ (MEDIUM)

| –ó–∞–¥–∞—á–∞ | –ò–Ω—Ç–µ—Ä–≤–∞–ª | –ò—Å—Ç–æ—á–Ω–∏–∫ –≤—Ä–µ–º–µ–Ω–∏ |
|--------|----------|------------------|
| Goods Delta | 1 –º–∏–Ω | `Sync_Goods_LastDelta` |
| Images Delta | 1 –º–∏–Ω | `Sync_Images_LastDelta` |
| References | 1 –¥–µ–Ω—å | `Sync_References_LastRun` |

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –ø–æ –ê—Ç—Ä–∏–±—É—Ç–∞–º:** 
> 1. –°–∞–º–∏ –∞—Ç—Ä–∏–±—É—Ç—ã (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è) –∏ –∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è (—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏) —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –≤ **Initial/Daily** —ç—Ç–∞–ø–∞—Ö (–ø–µ—Ä–µ–¥ —Ç–æ–≤–∞—Ä–∞–º–∏).
> 2. –°–≤—è–∑–∏ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ —Å —Ç–æ–≤–∞—Ä–∞–º–∏ (`goodsattributes`) –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è **–≤–º–µ—Å—Ç–µ —Å —Ç–æ–≤–∞—Ä–∞–º–∏** (inline), —Ç–∞–∫ –∫–∞–∫ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Ö –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —Ç–æ–≤–∞—Ä–æ–≤ —Å —Ñ–ª–∞–≥–æ–º `with_attributes=1`. –û—Ç–¥–µ–ª—å–Ω—ã–π —ç—Ç–∞–ø —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å–≤—è–∑–µ–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.

**–õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```csharp
bool IsDue(task) => DateTime.UtcNow - task.LastRun >= task.Interval;
```

---

## Full Reload (LOW) ‚Äî –ª–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –ø–æ–ª–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ ~10,000 —Ç–æ–≤–∞—Ä–æ–≤ –∑–∞–Ω–∏–º–∞–µ—Ç –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.

**–†–µ—à–µ–Ω–∏–µ:** –∑–∞–≥—Ä—É–∂–∞–µ–º –ø–æ —á–∞—Å—Ç—è–º (chunks), —Å–æ—Ö—Ä–∞–Ω—è—è –ø—Ä–æ–≥—Ä–µ—Å—Å:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|----------|
| `FullReload_Goods_CurrentPage` | int | –¢–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ |
| `FullReload_Goods_TotalPages` | int | –í—Å–µ–≥–æ —Å—Ç—Ä–∞–Ω–∏—Ü |
| `FullReload_Goods_StartedAt` | DateTime | –ö–æ–≥–¥–∞ –Ω–∞—á–∞–ª–∏ —Ç–µ–∫—É—â–∏–π —Ü–∏–∫–ª |
| `FullReload_ChunkSize` | 5 | –°—Ç—Ä–∞–Ω–∏—Ü –∑–∞ –æ–¥–Ω—É –∏—Ç–µ—Ä–∞—Ü–∏—é |

```csharp
async Task RunFullReloadChunkAsync()
{
    var currentPage = await GetAsync("FullReload_Goods_CurrentPage");
    var totalPages = await GetAsync("FullReload_Goods_TotalPages");
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º ChunkSize —Å—Ç—Ä–∞–Ω–∏—Ü
    for (int i = 0; i < ChunkSize && currentPage <= totalPages; i++)
    {
        await LoadGoodsPageAsync(currentPage++);
        await SetAsync("FullReload_Goods_CurrentPage", currentPage);
    }
    
    // –ï—Å–ª–∏ –∑–∞–≤–µ—Ä—à–∏–ª–∏ —Ü–∏–∫–ª ‚Äî —Å–±—Ä–∞—Å—ã–≤–∞–µ–º
    if (currentPage > totalPages)
    {
        await SetAsync("FullReload_Goods_CurrentPage", 1);
        await SetAsync("Sync_Goods_LastFull", DateTime.UtcNow);
    }
}
```

---

## –î–∏–∞–≥—Ä–∞–º–º–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π

```mermaid
stateDiagram-v2
    [*] --> CheckInitial
    
    CheckInitial --> InitialSync: not complete
    CheckInitial --> CheckIncremental: complete
    
    InitialSync --> CheckInitial: done
    
    CheckIncremental --> RunIncremental: tasks due
    CheckIncremental --> CheckFullReload: no tasks due
    
    RunIncremental --> CheckIncremental: done
    
    CheckFullReload --> RunFullChunk: has pending work
    CheckFullReload --> Wait: no work
    
    RunFullChunk --> CheckIncremental: chunk done
    
    Wait --> CheckIncremental: timer elapsed
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```
MarketplaceSyncer.Service/
‚îú‚îÄ‚îÄ Services/
‚îÇ   ‚îú‚îÄ‚îÄ SyncOrchestrator.cs        # –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ SyncStateRepository.cs     # –†–∞–±–æ—Ç–∞ —Å app_settings
‚îÇ   ‚îú‚îÄ‚îÄ Tasks/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ISyncTask.cs           # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–¥–∞—á–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GoodsDeltaTask.cs      # Incremental —Ç–æ–≤–∞—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ImagesDeltaTask.cs     # Incremental –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ReferencesSyncTask.cs  # –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ GoodsFullReloadTask.cs # –ü–æ–ª–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ —á–∞—Å—Ç—è–º
‚îÇ   ‚îú‚îÄ‚îÄ GoodsSyncer.cs             # –õ–æ–≥–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ ImageSyncService.cs        # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–≥–æ—Ç–æ–≤)
‚îî‚îÄ‚îÄ Configuration/
    ‚îî‚îÄ‚îÄ SynchronizationOptions.cs  # –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã
```

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```json
"Synchronization": {
  "GoodsDeltaInterval": "00:01:00",
  "ImagesDeltaInterval": "00:01:00", 
  "ReferencesInterval": "1.00:00:00",
  "FullReloadChunkSize": 5,
  "FullReloadTargetInterval": "1.00:00:00",
  "ForceInitialResync": false,
  "DailyFullResyncTime": "01:00:00",
  "FullResyncTimeZoneOffset": 3
}
```

---

## –°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω –∏ –æ—Å—Ç–∞—Ç–∫–æ–≤

–î–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ü–µ–Ω –∏ –æ—Å—Ç–∞—Ç–∫–æ–≤ –≤—ã–±—Ä–∞–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è **–ï–¥–∏–Ω–æ–≥–æ –ü–æ—Ç–æ–∫–∞ (Single Flow)** —á–µ—Ä–µ–∑ —Å—É—â–Ω–æ—Å—Ç—å `goods`.

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ï–¥–∏–Ω—ã–π –ø–æ—Ç–æ–∫ (–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
*   **–ú–µ—Ö–∞–Ω–∏–∑–º**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –¥–≤–∞ –ø–æ–ª—è –≤—Ä–µ–º–µ–Ω–∏:
    1.  `updated` ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–≤–æ–π—Å—Ç–≤ —Ç–æ–≤–∞—Ä–∞ (–Ω–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ, –∞—Ä—Ç–∏–∫—É–ª).
    2.  `updated_remains_prices` ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤ –∏ —Ü–µ–Ω.
    –ü—Ä–∏ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –æ–±–æ–∏–º –ø–æ–ª—è–º (–æ–±—ä–µ–¥–∏–Ω—è—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã), —á—Ç–æ–±—ã –∑–∞—Ö–≤–∞—Ç–∏—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.
*   **–õ–æ–≥–∏–∫–∞**: –í—ã–ø–æ–ª–Ω—è–µ–º "–£–º–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ" (Diff) –≤ –∫–æ–¥–µ:
    *   –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º `new_price` vs `db_price`. –†–∞–∑–Ω—ã–µ? ‚Üí –ó–∞–ø—É—Å–∫–∞–µ–º —Ñ–ª–æ—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω—ã.
    *   –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º `new_remains` vs `db_remains`. –†–∞–∑–Ω—ã–µ? ‚Üí –ó–∞–ø—É—Å–∫–∞–µ–º —Ñ–ª–æ—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤.
*   **–ü–ª—é—Å—ã**: –ü—Ä–æ—Å—Ç–æ—Ç–∞, –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (snapshot state), –µ–¥–∏–Ω—ã–π –∫—É—Ä—Å–æ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.
*   **–ú–∏–Ω—É—Å—ã**: –ò–∑–±—ã—Ç–æ—á–Ω—ã–π —Ç—Ä–∞—Ñ–∏–∫ (–∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –ø—Ä–∏ –º–µ–ª–∫–∏—Ö –ø—Ä–∞–≤–∫–∞—Ö).

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†–∞–∑–¥–µ–ª—å–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ (–û—Ç–ª–æ–∂–µ–Ω–æ)
*   **–ú–µ—Ö–∞–Ω–∏–∑–º**: –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –∑–∞–¥–∞—á–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –ª–µ–≥–∫–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã `currentprices` –∏ `remains`.
*   **–°—Ç–∞—Ç—É—Å**: –ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –±—É–¥—É—â–µ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏, –µ—Å–ª–∏ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ–∫–∞–∂—É—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –∫–∞–Ω–∞–ª.

