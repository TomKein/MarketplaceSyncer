# –†–µ–∑—é–º–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ v2.0

## –î–∞—Ç–∞: 2025-12-31

## –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏–∑ —Ñ–∏–¥–±–µ–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞

### ‚úÖ –†–µ—à–µ–Ω–æ: –ü—É–Ω–∫—Ç 1.4 - Drom –±–µ–∑ API
**–ü—Ä–æ–±–ª–µ–º–∞:** Drom –Ω–µ –∏–º–µ–µ—Ç –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ API  
**–†–µ—à–µ–Ω–∏–µ:** –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ - API –¥–ª—è Ozon/WB/Yandex, Selenium/XML –¥–ª—è Drom –∏ —á–∞—Å—Ç–∏—á–Ω–æ Avito

### ‚úÖ –†–µ—à–µ–Ω–æ: –†–∞–∑–¥–µ–ª 2.2 - –ñ–µ—Å—Ç–∫–∞—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ Business.ru
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ –Ω—Ä–∞–≤–∏—Ç—Å—è –∏–¥–µ—è —Å Business.ru "–ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ", –Ω—É–∂–Ω–∞ –≥–∏–±–∫–æ—Å—Ç—å –≤—ã–±–æ—Ä–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏—Å—Ç–∏–Ω—ã  
**–†–µ—à–µ–Ω–∏–µ:** 
- Business.ru –∫–∞–∫ **–æ—Å–Ω–æ–≤–Ω–æ–π** –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–±–∏—Ä–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫
- Event-driven –ø–æ–¥—Ö–æ–¥ —Å webhook –æ—Ç Business.ru
- Fallback polling –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º

### ‚úÖ –†–µ—à–µ–Ω–æ: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–∫—Ç—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤, –∑–Ω–∞—Ç—å —á—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ, –∞ —á—Ç–æ –Ω–µ—Ç  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–æ 4 –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
- `sync_events` - –æ—á–µ—Ä–µ–¥—å —Å–æ–±—ã—Ç–∏–π —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏
- `sync_history` - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –∫–∞–∂–¥–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–∞
- `reservations_lock` - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ–≥–æ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è
- `notifications` - —Å–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### ‚úÖ –†–µ—à–µ–Ω–æ: –ì–ª–∞–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ - –Ω–µ–Ω–∞–¥–µ–∂–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ
**–ü—Ä–æ–±–ª–µ–º–∞:** –î–≤–æ–π–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–∏ –∏–∑-–∑–∞ race condition –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞—Ö  
**–†–µ—à–µ–Ω–∏–µ:** –†–∞–∑–¥–µ–ª 4.6 - –ê—Ç–æ–º–∞—Ä–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ
- Distributed lock –Ω–∞ —É—Ä–æ–≤–Ω–µ PostgreSQL
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Å ACID –≥–∞—Ä–∞–Ω—Ç–∏—è–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ (timeout 5 –º–∏–Ω—É—Ç)
- Rollback –ø—Ä–∏ –ª—é–±—ã—Ö –æ—à–∏–±–∫–∞—Ö
- –ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### ‚úÖ –†–µ—à–µ–Ω–æ: –ù–µ–Ω–∞–¥–µ–∂–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ –∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–∞—Ä—Ç–æ—á–∫–∏ –∏ —Ñ–æ—Ç–æ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –Ω–µ–Ω–∞–¥–µ–∂–Ω–æ  
**–†–µ—à–µ–Ω–∏–µ:**
- Webhook –æ—Ç Business.ru –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–π —Ä–µ–∞–∫—Ü–∏–∏ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π (–ø—Ä–æ–¥–∞–∂–∏ > –æ—Å—Ç–∞—Ç–∫–∏ > —Ü–µ–Ω—ã > –∫–∞—Ä—Ç–æ—á–∫–∏)
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `sync_history` —Å —Ç–∏–ø–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
- Retry –º–µ—Ö–∞–Ω–∏–∑–º—ã —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π

### ‚úÖ –†–µ—à–µ–Ω–æ: –°–ª–æ–∂–Ω—ã–π –≤—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–æ—Å–æ–±–µ–Ω–Ω–æ Avito)
**–ü—Ä–æ–±–ª–µ–º–∞:** –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫—Ä–∞–π–Ω–µ —Å–ª–æ–∂–Ω–æ  
**–†–µ—à–µ–Ω–∏–µ:** –†–∞–∑–¥–µ–ª 5.4 - AI –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Google Gemini
- –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –º–æ–¥–µ–ª—å `gemini-1.5-flash`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- Confidence score - –µ—Å–ª–∏ < 0.7, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É
- –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ —Ç–æ–≤–∞—Ä–∞

### ‚úÖ –†–µ—à–µ–Ω–æ: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—à–∏–±–æ–∫
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù—É–∂–Ω–æ —Ä–∞–∑–ª–∏—á–∞—Ç—å —Ç–∏–ø—ã –æ—à–∏–±–æ–∫: –ø—Ä–æ–±–ª–µ–º—ã –≤ –∫–æ–¥–µ, –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–µ–π, –ø—Ä–æ–±–ª–µ–º—ã –∫–ª–∏–µ–Ω—Ç–∞  
**–†–µ—à–µ–Ω–∏–µ:** –†–∞–∑–¥–µ–ª 5.3 - –°–∏—Å—Ç–µ–º–∞ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –æ—à–∏–±–æ–∫
- **CODE_ERROR** - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ ‚Üí —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É (severity=1)
- **CLASSIFICATION_ERROR** - –Ω–µ–≤–µ—Ä–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è/–∞—Ç—Ä–∏–±—É—Ç—ã ‚Üí AI –ø—Ä–æ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–∏—Ç—å
- **USER_ACTION_REQUIRED** - –Ω—É–∂–Ω—ã –¥–µ–π—Å—Ç–≤–∏—è –∫–ª–∏–µ–Ω—Ç–∞ ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É (severity=3)
- **MARKETPLACE_ERROR** - –ø—Ä–æ–±–ª–µ–º—ã –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞ ‚Üí retry + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

### ‚úÖ –†–µ—à–µ–Ω–æ: Telegram Bot –∏ Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù—É–∂–µ–Ω —Å–ø–æ—Å–æ–± —É–≤–µ–¥–æ–º–ª—è—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞  
**–†–µ—à–µ–Ω–∏–µ:**
- Telegram Bot –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–±—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–∫—Ü–∏—è)
- Email –¥–ª—è –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏ –∏ –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É –æ—à–∏–±–∫–∏
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å emoji –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏

### ‚úÖ –†–µ—à–µ–Ω–æ: Event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù—É–∂–Ω–∞ –±—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è –ø—Ä–æ–¥–∞–∂, —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è, –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω  
**–†–µ—à–µ–Ω–∏–µ:**
- Webhook endpoint –¥–ª—è –ø—Ä–∏–µ–º–∞ —Å–æ–±—ã—Ç–∏–π –æ—Ç Business.ru
- –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—á–µ—Ä–µ–¥—å —Å–æ–±—ã—Ç–∏–π `sync_events`
- –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è: –∑–∞–∫–∞–∑—ã (1) > –æ—Å—Ç–∞—Ç–∫–∏ (2) > —Ü–µ–Ω—ã (3) > –∫–∞—Ä—Ç–æ—á–∫–∏ (5)
- –§–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π
- Fallback polling –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç

## –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ)

```
Business.ru (CRM) - –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã
    ‚Üì webhooks (—Ä–µ–∞–ª-—Ç–∞–π–º)
WebhookListener (HTTP endpoint)
    ‚Üì
EventQueue (–ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è)
    ‚Üì
SyncOrchestrator (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è)
    ‚Üì
Marketplace Services (Ozon, WB, Yandex, Avito, Drom)
    ‚Üì
ReservationManager (–∞—Ç–æ–º–∞—Ä–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ)
    ‚Üì
NotificationService (Telegram/Email)
    ‚Üì
PostgreSQL (sync_history, sync_events, reservations_lock, notifications)
```

## –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏

1. **‚ö° –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - webhook –≤–º–µ—Å—Ç–æ polling
2. **üîí –ù–∏–∫–∞–∫–∏—Ö –¥–≤–æ–π–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂** - distributed lock + —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
3. **üìä –ü–æ–ª–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** - –∏—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
4. **ü§ñ –£–º–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** - AI –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç 80% –æ—à–∏–±–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏
5. **üì¢ –ü—Ä–æ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö –¥–æ –∏—Ö –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏
6. **üéØ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è** - –∫–∞–∂–¥–∞—è –æ—à–∏–±–∫–∞ –ø–æ–ø–∞–¥–∞–µ—Ç –∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É —á–µ–ª–æ–≤–µ–∫—É

## –°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø - –û—Ç—á–µ—Ç–Ω–æ—Å—Ç—å

–ü–æ—Å–ª–µ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞:
- –î–∞—à–±–æ—Ä–¥ —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π
- –û—Ç—á–µ—Ç—ã –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º —Å —Ä–∞–∑–±–∏–≤–∫–æ–π –ø–æ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞–º
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫ –∏ –≤—Ä–µ–º–µ–Ω–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –ú–µ—Ç—Ä–∏–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ AI –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ—Ç—á–µ—Ç—ã –∏ reconciliation

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Backend:** .NET 8, ASP.NET Core Worker Service
- **Database:** PostgreSQL 15+ —Å ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
- **ORM:** Linq2Db + FluentMigrator
- **AI:** Google Gemini API (–±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è)
- **Notifications:** Telegram Bot API, SMTP Email
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** Event-driven —Å –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–µ–π
- **Resilience:** Polly –¥–ª—è retry, distributed lock –¥–ª—è consistency

## –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

- ‚úÖ **0 –¥–≤–æ–π–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂** - distributed lock —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ **< 1 –º–∏–Ω –∑–∞–¥–µ—Ä–∂–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏** - webhook —Ä–µ–∞–ª-—Ç–∞–π–º
- ‚úÖ **> 95% —Ç–æ—á–Ω–æ—Å—Ç—å AI** - –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ **100% –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º–æ—Å—Ç—å** - –≤—Å–µ –≤ sync_history
- ‚úÖ **< 5% —Ä—É—á–Ω—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π** - –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞
